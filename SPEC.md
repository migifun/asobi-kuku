# 九九チャレンジ - 仕様書

## 概要

4歳児向けの九九（掛け算）学習ブラウザゲーム。
九九の問題がランダムに出題され、ひらがなの読み仮名とともに表示される。
4つの選択肢から正解を選ぶ形式。
5問正解するとクリアとなり、アイテム（武器・装備・道具 全30種）をゲットできる。

## ゲームフロー

```
タイトル → 段選択/ランダム → 出題 → 回答 → ○/✕ → ...（5問正解まで繰り返し）→ 結果画面
                                                                                    └─ アイテムGET!
                                                                                  [もういちど] [もどる]
タイトル → アイテムずかん → 一覧表示 → [もどる]
```

1. スタート画面を表示
2. 段を選択（1〜9の段）、または「ぜんぶランダム」を選択
3. 九九の問題が1問表示される
4. 4つの選択肢ボタンから答えを選ぶ
5. 正解なら ○（＋正解SE）、不正解なら ✕（＋不正解SE）を表示
6. 5問正解するまで繰り返し（間違えてもゲームオーバーにならない）
7. 5問正解でクリア → 結果画面へ遷移、アイテム獲得（＋ファンファーレSE）
8. 「もういちど」で再挑戦、「もどる」でタイトルへ

## 画面構成

### スタート画面

- タイトル「ハルくんのくくチャレンジ」
- 段選択ボタン（1〜9の段、各色）
- 「ぜんぶランダム」ボタン
- 「アイテムずかん」ボタン

### 出題画面

- 戻るボタン
- 進捗表示（「せいかい 3/5」）
- 問題表示エリア（例: `3 × 7 = ?`）
- ひらがな読み仮名（例: `さんしち？`）
  - 最初は答え部分を「？」で隠す
  - 3秒後に答えの読みを赤色で表示（例: `さんしち`<span style="color:red">`にじゅういち`</span>）
  - 3秒以内に回答した場合はヒント表示しない
- 4つの選択肢ボタン（大きめ、タップしやすく、赤・青・黄・緑の4色）

### 結果表示（出題画面上にオーバーレイ）

- 正解: ○ を大きく表示
- 不正解: ✕ を大きく表示し、正解も表示する
- 「つぎへ」ボタン（最終問は「けっかへ」）

### 結果画面

- 「5もん クリア！」表示
- アイテム獲得演出（emoji＋アイテム名、ポップアニメーション）
- 全アイテム収集済みの場合は「コンプリート！」表示
- 「もういちど」「もどる」ボタン

### アイテム図鑑画面

- タイトル「アイテムずかん」
- 収集数表示（例: `5/30`）
- 30種を3列グリッドで一覧表示
  - 取得済み: emoji＋名前
  - 未取得: ❓＋「？？？」
- 「もどる」ボタン
- 「リセット」ボタン（確認ダイアログ付き）

## 問題生成ルール

- 1×1 〜 9×9 の全81問からランダムに出題（段選択時はその段のみ）
- 同じ問題が連続しないようにする

## 選択肢生成ルール

- 正解1つ + 不正解3つ の計4つ
- 不正解の生成方法:
  - 正解に近い値から優先的に選出（近い数ほど紛らわしい）
  - 九九の答えとして存在する値を使用
  - 全て異なる値であること
- 選択肢の並び順はランダムにシャッフル

## 九九の読み仮名

伝統的な九九の読み方を使用する。

例:
| 式 | 読み |
|---|---|
| 2 × 2 = 4 | ににんがし |
| 2 × 3 = 6 | にさんがろく |
| 3 × 7 = 21 | さんしちにじゅういち |
| 7 × 7 = 49 | しちしちしじゅうく |

- 答えが一桁の場合は「〇〇が〇」形式（例: にさん**が**ろく）
- 答えが二桁の場合は「〇〇〇〇」形式（例: にご**じゅう**）

## アイテム一覧（全30種）

| # | emoji | 名前 | 分類 |
|---|---|---|---|
| 1 | 🪵🗡️ | きのけん | けん |
| 2 | ⚔️ | てつのけん | けん |
| 3 | 🔥🗡️ | ほのおのけん | けん |
| 4 | ❄️🗡️ | こおりのけん | けん |
| 5 | ⭐🗡️ | ほしのつるぎ | けん |
| 6 | 👑🗡️ | でんせつのけん | けん |
| 7 | 🔱 | てつのやり | やり |
| 8 | ⚡🔱 | いかづちのやり | やり |
| 9 | 🪄 | まほうのつえ | つえ |
| 10 | 🔥🪄 | ほのおのつえ | つえ |
| 11 | ❄️🪄 | こおりのつえ | つえ |
| 12 | 🪵🪓 | きのおの | おの |
| 13 | ✨🪓 | きんのおの | おの |
| 14 | 🏹 | きのゆみ | ゆみ |
| 15 | 🌈🏹 | にじのゆみ | ゆみ |
| 16 | 🪵🛡️ | きのたて | たて |
| 17 | 🛡️ | てつのたて | たて |
| 18 | 💎🛡️ | ダイヤのたて | たて |
| 19 | 👒 | かわのぼうし | そうび |
| 20 | 🪖 | てつのかぶと | そうび |
| 21 | 👢 | かわのくつ | そうび |
| 22 | 🪄💍 | まほうのゆびわ | そうび |
| 23 | 👑 | おうかん | そうび |
| 24 | 🧪 | いやしのくすり | どうぐ |
| 25 | 🔮 | すいしょうだま | どうぐ |
| 26 | 🔔 | ぎんのすず | どうぐ |
| 27 | 🗝️ | ひみつのかぎ | どうぐ |
| 28 | 🌟 | ほしのかけら | どうぐ |
| 29 | 🌈💎 | にじのけっしょう | どうぐ |
| 30 | 🪙 | きんか | どうぐ |

- アイテムはlocalStorageに保存（リロード後も維持）
- 5問正解ごとに未取得アイテムからランダムに1つ獲得
- 全30種コンプリート後は獲得演出のみ変化

## 効果音（Web Audio API）

| タイミング | 音 |
|---|---|
| ボタンタップ | ポンッ（短い高音） |
| 正解 | ピンポン♪（高音2音） |
| 不正解 | ブブー（低音ブザー） |
| アイテムゲット | ファンファーレ（ド・ミ・ソ・ド↑の4音） |

- 音声ファイル不要、Web Audio APIで生成

## UIデザイン方針

- **カラフル・ポップ** なデザイン
- グラデーション背景（アニメーション付き）
- 選択肢ボタンはそれぞれ異なる色（赤・青・黄・緑）
- 文字は大きく、読みやすいフォント（Zen Maru Gothic）
- 4歳児がタップ/クリックしやすい大きなボタン
- レスポンシブ対応（スマホ・タブレットで遊べるように）
- アイテム獲得時のポップ＋バウンスアニメーション

## 技術スタック

- **Vite** - ビルドツール
- **TypeScript** - 言語
- **HTML/CSS** - UIライブラリなし、シンプルに構成
- **Web Audio API** - 効果音生成
- **localStorage** - アイテム所持状況の永続化
- **Cloudflare Pages** - デプロイ先（将来）

## プロジェクト構成

```
game-9x9/
├── index.html
├── package.json
├── tsconfig.json
├── SPEC.md
└── src/
    ├── main.ts          # エントリーポイント
    ├── style.css         # スタイル
    ├── game.ts           # ゲームロジック（出題・判定）
    ├── kuku-data.ts      # 九九の読み仮名データ
    ├── items.ts          # アイテムデータ・localStorage管理
    ├── sound.ts          # 効果音（Web Audio API）
    └── ui.ts             # 画面描画・DOM操作・セッション管理
```
